<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Submit Rating</title>
</head>
<body>
    <h1>Quality &amp; Courtesy Rating</h1>
    {% if error %}
    <p style="color:red;">{{ error }}</p>
    {% endif %}
    {% if request.args.get('success') %}
    <p style="color:green;">Submission saved. You can add another or view the dashboard.</p>
    {% endif %}
    <form method="post" action="/rate">
        <label for="visit_date">Visit date:</label>
        <input type="date" id="visit_date" name="visit_date" required><br><br>

        <label for="nurse">Nurse courtesy (1–5):</label>
        <input type="number" id="nurse" name="nurse" min="1" max="5" required><br><br>

        <label for="physician">Physician courtesy (1–5):</label>
        <input type="number" id="physician" name="physician" min="1" max="5" required><br><br>

        <button type="submit">Submit</button>
    </form>
    <p>
        <a href="/dashboard"><button type="button">View Dashboard</button></a>
    </p>
    <script>
        (function(){
            try {
                const params = new URLSearchParams(window.location.search);
                if (params.get('success') === '1') {
                    const form = document.querySelector('form[action="/rate"]');
                    if (form && typeof form.reset === 'function') form.reset();
                    // remove success flag from URL without reloading
                    params.delete('success');
                    const newQuery = params.toString();
                    const newUrl = window.location.pathname + (newQuery ? ('?' + newQuery) : '');
                    window.history.replaceState({}, '', newUrl);
                }
            } catch (e) {
                /* noop */
            }
        })();
    </script>
</body>
</html>
